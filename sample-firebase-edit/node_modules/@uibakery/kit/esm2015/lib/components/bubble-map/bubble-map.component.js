/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { HttpClient } from '@angular/common/http';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';
import { NbThemeService } from '@nebular/theme';
import { registerMap } from 'echarts';
import { combineLatest, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
export class BkBubbleMapComponent {
    /**
     * @param {?} theme
     * @param {?} http
     * @param {?} cd
     */
    constructor(theme, http, cd) {
        this.theme = theme;
        this.http = http;
        this.cd = cd;
        this.options = {};
        this._data = { countryCoordinates: [], mapData: [] };
        this.colorConfig = {};
        this.geoColors = [];
        this.countryColorMap = {};
        this.max = -Infinity;
        this.destroyed$ = new Subject();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    set data(data) {
        this._data = data;
        // avoid showing map without colors
        if (this.initialized) {
            this.updateOptions();
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        combineLatest([
            this.http.get('assets/map/world.json'),
            this.theme.getJsTheme(),
        ])
            .pipe(takeUntil(this.destroyed$))
            .subscribe((/**
         * @param {?} __0
         * @return {?}
         */
        ([map, config]) => {
            registerMap('world', map);
            this.initColors(config);
            this.updateOptions();
            this.initialized = true;
            this.cd.detectChanges();
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.destroyed$.next();
    }
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    initColors(config) {
        this.colorConfig = config.variables.bubbleMap;
        this.geoColors = [
            this.colorConfig.primary,
            this.colorConfig.info,
            this.colorConfig.success,
            this.colorConfig.warning,
            this.colorConfig.danger,
        ];
        this._data.mapData.forEach((/**
         * @param {?} itemOpt
         * @return {?}
         */
        itemOpt => {
            this.countryColorMap[itemOpt.name] = this.getRandomGeoColor();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    updateOptions() {
        this._data.mapData.forEach((/**
         * @param {?} itemOpt
         * @return {?}
         */
        (itemOpt) => {
            if (itemOpt.value > this.max) {
                this.max = itemOpt.value;
            }
        }));
        this.options = {
            title: {
                text: 'World Population (2011)',
                left: 'center',
                top: 'top',
                textStyle: {
                    color: this.colorConfig.titleColor,
                },
            },
            tooltip: {
                trigger: 'item',
                formatter: (/**
                 * @param {?} params
                 * @return {?}
                 */
                params => {
                    return params.name + ': ' + params.value[2];
                }),
            },
            visualMap: {
                show: false,
                min: 0,
                max: this.max,
                inRange: {
                    symbolSize: [6, 60],
                },
            },
            geo: {
                name: 'World Population (2010)',
                type: 'map',
                map: 'world',
                roam: true,
                label: {
                    emphasis: {
                        show: false,
                    },
                },
                itemStyle: {
                    normal: {
                        areaColor: this.colorConfig.areaColor,
                        borderColor: this.colorConfig.areaBorderColor,
                    },
                    emphasis: {
                        areaColor: this.colorConfig.areaHoverColor,
                    },
                },
                zoom: 1.1,
            },
            series: [
                {
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    data: this._data.mapData.map((/**
                     * @param {?} itemOpt
                     * @return {?}
                     */
                    itemOpt => {
                        return {
                            name: itemOpt.name,
                            value: [
                                this._data.countryCoordinates[itemOpt.code].longitude,
                                this._data.countryCoordinates[itemOpt.code].latitude,
                                itemOpt.value,
                            ],
                            itemStyle: {
                                normal: {
                                    color: this.getCountryColor(itemOpt.name),
                                },
                            },
                        };
                    })),
                },
            ],
        };
    }
    /**
     * @private
     * @param {?} countryName
     * @return {?}
     */
    getCountryColor(countryName) {
        /** @type {?} */
        const color = this.countryColorMap[countryName];
        if (color) {
            return color;
        }
        /** @type {?} */
        const generatedColor = this.getRandomGeoColor();
        this.countryColorMap[countryName] = generatedColor;
        return generatedColor;
    }
    /**
     * @private
     * @return {?}
     */
    getRandomGeoColor() {
        /** @type {?} */
        const index = Math.round(Math.random() * this.geoColors.length);
        return this.geoColors[index];
    }
}
BkBubbleMapComponent.decorators = [
    { type: Component, args: [{
                selector: 'bk-bubble-map',
                changeDetection: ChangeDetectionStrategy.OnPush,
                template: `
    <div echarts [options]="options" [autoResize]="true" [style.height.%]="100"></div>
  `,
                styles: [':host { display: block }']
            }] }
];
/** @nocollapse */
BkBubbleMapComponent.ctorParameters = () => [
    { type: NbThemeService },
    { type: HttpClient },
    { type: ChangeDetectorRef }
];
BkBubbleMapComponent.propDecorators = {
    data: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    BkBubbleMapComponent.prototype.options;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype._data;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.colorConfig;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.geoColors;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.countryColorMap;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.max;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.destroyed$;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.theme;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnViYmxlLW1hcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdWliYWtlcnkva2l0LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYnViYmxlLW1hcC9idWJibGUtbWFwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUNoSCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUN0QyxPQUFPLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFZM0MsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7O0lBeUIvQixZQUFvQixLQUFxQixFQUFVLElBQWdCLEVBQVUsRUFBcUI7UUFBOUUsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFkbEcsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQUVWLFVBQUssR0FBK0MsRUFBRSxrQkFBa0IsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBRTVGLGdCQUFXLEdBQVEsRUFBRSxDQUFDO1FBQ3RCLGNBQVMsR0FBVSxFQUFFLENBQUM7UUFDdEIsb0JBQWUsR0FBUSxFQUFFLENBQUM7UUFFMUIsUUFBRyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBSWhCLGVBQVUsR0FBa0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUdsRCxDQUFDOzs7OztJQXhCRCxJQUFhLElBQUksQ0FBQyxJQUFnRDtRQUNoRSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUVsQixtQ0FBbUM7UUFDbkMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUN0QjtJQUNILENBQUM7Ozs7SUFtQkQsUUFBUTtRQUNOLGFBQWEsQ0FBQztZQUNaLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDO1lBQ3RDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFO1NBQ3hCLENBQUM7YUFDQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQzthQUNoQyxTQUFTOzs7O1FBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQTBCLEVBQUUsRUFBRTtZQUNwRCxXQUFXLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBRXJCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDMUIsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7O0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQzs7Ozs7O0lBRU8sVUFBVSxDQUFDLE1BQXdCO1FBQ3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7UUFFOUMsSUFBSSxDQUFDLFNBQVMsR0FBRztZQUNmLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTztZQUN4QixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUk7WUFDckIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPO1lBQ3hCLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTztZQUN4QixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU07U0FDeEIsQ0FBQztRQUVGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU87Ozs7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNuQyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUNoRSxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7O0lBRU8sYUFBYTtRQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPOzs7O1FBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUNyQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDNUIsSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO2FBQzFCO1FBQ0gsQ0FBQyxFQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRSx5QkFBeUI7Z0JBQy9CLElBQUksRUFBRSxRQUFRO2dCQUNkLEdBQUcsRUFBRSxLQUFLO2dCQUNWLFNBQVMsRUFBRTtvQkFDVCxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVO2lCQUNuQzthQUNGO1lBQ0QsT0FBTyxFQUFFO2dCQUNQLE9BQU8sRUFBRSxNQUFNO2dCQUNmLFNBQVM7Ozs7Z0JBQUUsTUFBTSxDQUFDLEVBQUU7b0JBQ2xCLE9BQU8sTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUMsQ0FBQyxDQUFBO2FBQ0Y7WUFDRCxTQUFTLEVBQUU7Z0JBQ1QsSUFBSSxFQUFFLEtBQUs7Z0JBQ1gsR0FBRyxFQUFFLENBQUM7Z0JBQ04sR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO2dCQUNiLE9BQU8sRUFBRTtvQkFDUCxVQUFVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUNwQjthQUNGO1lBQ0QsR0FBRyxFQUFFO2dCQUNILElBQUksRUFBRSx5QkFBeUI7Z0JBQy9CLElBQUksRUFBRSxLQUFLO2dCQUNYLEdBQUcsRUFBRSxPQUFPO2dCQUNaLElBQUksRUFBRSxJQUFJO2dCQUNWLEtBQUssRUFBRTtvQkFDTCxRQUFRLEVBQUU7d0JBQ1IsSUFBSSxFQUFFLEtBQUs7cUJBQ1o7aUJBQ0Y7Z0JBQ0QsU0FBUyxFQUFFO29CQUNULE1BQU0sRUFBRTt3QkFDTixTQUFTLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTO3dCQUNyQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxlQUFlO3FCQUM5QztvQkFDRCxRQUFRLEVBQUU7d0JBQ1IsU0FBUyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYztxQkFDM0M7aUJBQ0Y7Z0JBQ0QsSUFBSSxFQUFFLEdBQUc7YUFDVjtZQUNELE1BQU0sRUFBRTtnQkFDTjtvQkFDRSxJQUFJLEVBQUUsU0FBUztvQkFDZixnQkFBZ0IsRUFBRSxLQUFLO29CQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRzs7OztvQkFBQyxPQUFPLENBQUMsRUFBRTt3QkFDckMsT0FBTzs0QkFDTCxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUk7NEJBQ2xCLEtBQUssRUFBRTtnQ0FDTCxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTO2dDQUNyRCxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRO2dDQUNwRCxPQUFPLENBQUMsS0FBSzs2QkFDZDs0QkFDRCxTQUFTLEVBQUU7Z0NBQ1QsTUFBTSxFQUFFO29DQUNOLEtBQUssRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7aUNBQzFDOzZCQUNGO3lCQUNGLENBQUM7b0JBQ0osQ0FBQyxFQUFDO2lCQUNIO2FBQ0Y7U0FDRixDQUFDO0lBQ0osQ0FBQzs7Ozs7O0lBRU8sZUFBZSxDQUFDLFdBQVc7O2NBQzNCLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQztRQUMvQyxJQUFJLEtBQUssRUFBRTtZQUNULE9BQU8sS0FBSyxDQUFDO1NBQ2Q7O2NBRUssY0FBYyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtRQUMvQyxJQUFJLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxHQUFHLGNBQWMsQ0FBQztRQUVuRCxPQUFPLGNBQWMsQ0FBQztJQUN4QixDQUFDOzs7OztJQUVPLGlCQUFpQjs7Y0FDakIsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDO1FBQy9ELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMvQixDQUFDOzs7WUFwS0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxlQUFlO2dCQUN6QixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtnQkFJL0MsUUFBUSxFQUFFOztHQUVUO3lCQUpDLDBCQUEwQjthQUs3Qjs7OztZQWZRLGNBQWM7WUFGZCxVQUFVO1lBQ2UsaUJBQWlCOzs7bUJBbUJoRCxLQUFLOzs7O0lBU04sdUNBQWtCOzs7OztJQUVsQixxQ0FBb0c7Ozs7O0lBRXBHLDJDQUE4Qjs7Ozs7SUFDOUIseUNBQThCOzs7OztJQUM5QiwrQ0FBa0M7Ozs7O0lBRWxDLG1DQUF3Qjs7Ozs7SUFFeEIsMkNBQTZCOzs7OztJQUU3QiwwQ0FBa0Q7Ozs7O0lBRXRDLHFDQUE2Qjs7Ozs7SUFBRSxvQ0FBd0I7Ozs7O0lBQUUsa0NBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5iVGhlbWVTZXJ2aWNlIH0gZnJvbSAnQG5lYnVsYXIvdGhlbWUnO1xuaW1wb3J0IHsgTmJKU1RoZW1lT3B0aW9ucyB9IGZyb20gJ0BuZWJ1bGFyL3RoZW1lL3NlcnZpY2VzL2pzLXRoZW1lcy90aGVtZS5vcHRpb25zJztcbmltcG9ydCB7IHJlZ2lzdGVyTWFwIH0gZnJvbSAnZWNoYXJ0cyc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JrLWJ1YmJsZS1tYXAnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgc3R5bGVzOiBbXG4gICAgJzpob3N0IHsgZGlzcGxheTogYmxvY2sgfScsXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBlY2hhcnRzIFtvcHRpb25zXT1cIm9wdGlvbnNcIiBbYXV0b1Jlc2l6ZV09XCJ0cnVlXCIgW3N0eWxlLmhlaWdodC4lXT1cIjEwMFwiPjwvZGl2PlxuICBgLFxufSlcbmV4cG9ydCBjbGFzcyBCa0J1YmJsZU1hcENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKSBzZXQgZGF0YShkYXRhOiB7IGNvdW50cnlDb29yZGluYXRlczoge30sIG1hcERhdGE6IGFueVtdIH0pIHtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcblxuICAgIC8vIGF2b2lkIHNob3dpbmcgbWFwIHdpdGhvdXQgY29sb3JzXG4gICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIG9wdGlvbnM6IGFueSA9IHt9O1xuXG4gIHByaXZhdGUgX2RhdGE6IHsgY291bnRyeUNvb3JkaW5hdGVzOiB7fSwgbWFwRGF0YTogYW55W10gfSA9IHsgY291bnRyeUNvb3JkaW5hdGVzOiBbXSwgbWFwRGF0YTogW10gfTtcblxuICBwcml2YXRlIGNvbG9yQ29uZmlnOiBhbnkgPSB7fTtcbiAgcHJpdmF0ZSBnZW9Db2xvcnM6IGFueVtdID0gW107XG4gIHByaXZhdGUgY291bnRyeUNvbG9yTWFwOiBhbnkgPSB7fTtcblxuICBwcml2YXRlIG1heCA9IC1JbmZpbml0eTtcblxuICBwcml2YXRlIGluaXRpYWxpemVkOiBib29sZWFuO1xuXG4gIHByaXZhdGUgZGVzdHJveWVkJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0aGVtZTogTmJUaGVtZVNlcnZpY2UsIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy5odHRwLmdldCgnYXNzZXRzL21hcC93b3JsZC5qc29uJyksXG4gICAgICB0aGlzLnRoZW1lLmdldEpzVGhlbWUoKSxcbiAgICBdKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpXG4gICAgICAuc3Vic2NyaWJlKChbbWFwLCBjb25maWddOiBbYW55LCBOYkpTVGhlbWVPcHRpb25zXSkgPT4ge1xuICAgICAgICByZWdpc3Rlck1hcCgnd29ybGQnLCBtYXApO1xuICAgICAgICB0aGlzLmluaXRDb2xvcnMoY29uZmlnKTtcbiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zKCk7XG5cbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0Q29sb3JzKGNvbmZpZzogTmJKU1RoZW1lT3B0aW9ucykge1xuICAgIHRoaXMuY29sb3JDb25maWcgPSBjb25maWcudmFyaWFibGVzLmJ1YmJsZU1hcDtcblxuICAgIHRoaXMuZ2VvQ29sb3JzID0gW1xuICAgICAgdGhpcy5jb2xvckNvbmZpZy5wcmltYXJ5LFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy5pbmZvLFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy5zdWNjZXNzLFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy53YXJuaW5nLFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy5kYW5nZXIsXG4gICAgXTtcblxuICAgIHRoaXMuX2RhdGEubWFwRGF0YS5mb3JFYWNoKGl0ZW1PcHQgPT4ge1xuICAgICAgdGhpcy5jb3VudHJ5Q29sb3JNYXBbaXRlbU9wdC5uYW1lXSA9IHRoaXMuZ2V0UmFuZG9tR2VvQ29sb3IoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlT3B0aW9ucygpIHtcbiAgICB0aGlzLl9kYXRhLm1hcERhdGEuZm9yRWFjaCgoaXRlbU9wdCkgPT4ge1xuICAgICAgaWYgKGl0ZW1PcHQudmFsdWUgPiB0aGlzLm1heCkge1xuICAgICAgICB0aGlzLm1heCA9IGl0ZW1PcHQudmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICB0aXRsZToge1xuICAgICAgICB0ZXh0OiAnV29ybGQgUG9wdWxhdGlvbiAoMjAxMSknLFxuICAgICAgICBsZWZ0OiAnY2VudGVyJyxcbiAgICAgICAgdG9wOiAndG9wJyxcbiAgICAgICAgdGV4dFN0eWxlOiB7XG4gICAgICAgICAgY29sb3I6IHRoaXMuY29sb3JDb25maWcudGl0bGVDb2xvcixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB0b29sdGlwOiB7XG4gICAgICAgIHRyaWdnZXI6ICdpdGVtJyxcbiAgICAgICAgZm9ybWF0dGVyOiBwYXJhbXMgPT4ge1xuICAgICAgICAgIHJldHVybiBwYXJhbXMubmFtZSArICc6ICcgKyBwYXJhbXMudmFsdWVbMl07XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdmlzdWFsTWFwOiB7XG4gICAgICAgIHNob3c6IGZhbHNlLFxuICAgICAgICBtaW46IDAsXG4gICAgICAgIG1heDogdGhpcy5tYXgsXG4gICAgICAgIGluUmFuZ2U6IHtcbiAgICAgICAgICBzeW1ib2xTaXplOiBbNiwgNjBdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGdlbzoge1xuICAgICAgICBuYW1lOiAnV29ybGQgUG9wdWxhdGlvbiAoMjAxMCknLFxuICAgICAgICB0eXBlOiAnbWFwJyxcbiAgICAgICAgbWFwOiAnd29ybGQnLFxuICAgICAgICByb2FtOiB0cnVlLFxuICAgICAgICBsYWJlbDoge1xuICAgICAgICAgIGVtcGhhc2lzOiB7XG4gICAgICAgICAgICBzaG93OiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBpdGVtU3R5bGU6IHtcbiAgICAgICAgICBub3JtYWw6IHtcbiAgICAgICAgICAgIGFyZWFDb2xvcjogdGhpcy5jb2xvckNvbmZpZy5hcmVhQ29sb3IsXG4gICAgICAgICAgICBib3JkZXJDb2xvcjogdGhpcy5jb2xvckNvbmZpZy5hcmVhQm9yZGVyQ29sb3IsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbXBoYXNpczoge1xuICAgICAgICAgICAgYXJlYUNvbG9yOiB0aGlzLmNvbG9yQ29uZmlnLmFyZWFIb3ZlckNvbG9yLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHpvb206IDEuMSxcbiAgICAgIH0sXG4gICAgICBzZXJpZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdzY2F0dGVyJyxcbiAgICAgICAgICBjb29yZGluYXRlU3lzdGVtOiAnZ2VvJyxcbiAgICAgICAgICBkYXRhOiB0aGlzLl9kYXRhLm1hcERhdGEubWFwKGl0ZW1PcHQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgbmFtZTogaXRlbU9wdC5uYW1lLFxuICAgICAgICAgICAgICB2YWx1ZTogW1xuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEuY291bnRyeUNvb3JkaW5hdGVzW2l0ZW1PcHQuY29kZV0ubG9uZ2l0dWRlLFxuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEuY291bnRyeUNvb3JkaW5hdGVzW2l0ZW1PcHQuY29kZV0ubGF0aXR1ZGUsXG4gICAgICAgICAgICAgICAgaXRlbU9wdC52YWx1ZSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgaXRlbVN0eWxlOiB7XG4gICAgICAgICAgICAgICAgbm9ybWFsOiB7XG4gICAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5nZXRDb3VudHJ5Q29sb3IoaXRlbU9wdC5uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q291bnRyeUNvbG9yKGNvdW50cnlOYW1lKSB7XG4gICAgY29uc3QgY29sb3IgPSB0aGlzLmNvdW50cnlDb2xvck1hcFtjb3VudHJ5TmFtZV07XG4gICAgaWYgKGNvbG9yKSB7XG4gICAgICByZXR1cm4gY29sb3I7XG4gICAgfVxuXG4gICAgY29uc3QgZ2VuZXJhdGVkQ29sb3IgPSB0aGlzLmdldFJhbmRvbUdlb0NvbG9yKCk7XG4gICAgdGhpcy5jb3VudHJ5Q29sb3JNYXBbY291bnRyeU5hbWVdID0gZ2VuZXJhdGVkQ29sb3I7XG5cbiAgICByZXR1cm4gZ2VuZXJhdGVkQ29sb3I7XG4gIH1cblxuICBwcml2YXRlIGdldFJhbmRvbUdlb0NvbG9yKCkge1xuICAgIGNvbnN0IGluZGV4ID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogdGhpcy5nZW9Db2xvcnMubGVuZ3RoKTtcbiAgICByZXR1cm4gdGhpcy5nZW9Db2xvcnNbaW5kZXhdO1xuICB9XG59XG4iXX0=