/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';
import { NbThemeService } from '@nebular/theme';
import { registerMap } from 'echarts';
import { combineLatest, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
var BkBubbleMapComponent = /** @class */ (function () {
    function BkBubbleMapComponent(theme, http, cd) {
        this.theme = theme;
        this.http = http;
        this.cd = cd;
        this.options = {};
        this._data = { countryCoordinates: [], mapData: [] };
        this.colorConfig = {};
        this.geoColors = [];
        this.countryColorMap = {};
        this.max = -Infinity;
        this.destroyed$ = new Subject();
    }
    Object.defineProperty(BkBubbleMapComponent.prototype, "data", {
        set: /**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            this._data = data;
            // avoid showing map without colors
            if (this.initialized) {
                this.updateOptions();
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    BkBubbleMapComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        combineLatest([
            this.http.get('assets/map/world.json'),
            this.theme.getJsTheme(),
        ])
            .pipe(takeUntil(this.destroyed$))
            .subscribe((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var _b = tslib_1.__read(_a, 2), map = _b[0], config = _b[1];
            registerMap('world', map);
            _this.initColors(config);
            _this.updateOptions();
            _this.initialized = true;
            _this.cd.detectChanges();
        }));
    };
    /**
     * @return {?}
     */
    BkBubbleMapComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroyed$.next();
    };
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    BkBubbleMapComponent.prototype.initColors = /**
     * @private
     * @param {?} config
     * @return {?}
     */
    function (config) {
        var _this = this;
        this.colorConfig = config.variables.bubbleMap;
        this.geoColors = [
            this.colorConfig.primary,
            this.colorConfig.info,
            this.colorConfig.success,
            this.colorConfig.warning,
            this.colorConfig.danger,
        ];
        this._data.mapData.forEach((/**
         * @param {?} itemOpt
         * @return {?}
         */
        function (itemOpt) {
            _this.countryColorMap[itemOpt.name] = _this.getRandomGeoColor();
        }));
    };
    /**
     * @private
     * @return {?}
     */
    BkBubbleMapComponent.prototype.updateOptions = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this._data.mapData.forEach((/**
         * @param {?} itemOpt
         * @return {?}
         */
        function (itemOpt) {
            if (itemOpt.value > _this.max) {
                _this.max = itemOpt.value;
            }
        }));
        this.options = {
            title: {
                text: 'World Population (2011)',
                left: 'center',
                top: 'top',
                textStyle: {
                    color: this.colorConfig.titleColor,
                },
            },
            tooltip: {
                trigger: 'item',
                formatter: (/**
                 * @param {?} params
                 * @return {?}
                 */
                function (params) {
                    return params.name + ': ' + params.value[2];
                }),
            },
            visualMap: {
                show: false,
                min: 0,
                max: this.max,
                inRange: {
                    symbolSize: [6, 60],
                },
            },
            geo: {
                name: 'World Population (2010)',
                type: 'map',
                map: 'world',
                roam: true,
                label: {
                    emphasis: {
                        show: false,
                    },
                },
                itemStyle: {
                    normal: {
                        areaColor: this.colorConfig.areaColor,
                        borderColor: this.colorConfig.areaBorderColor,
                    },
                    emphasis: {
                        areaColor: this.colorConfig.areaHoverColor,
                    },
                },
                zoom: 1.1,
            },
            series: [
                {
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    data: this._data.mapData.map((/**
                     * @param {?} itemOpt
                     * @return {?}
                     */
                    function (itemOpt) {
                        return {
                            name: itemOpt.name,
                            value: [
                                _this._data.countryCoordinates[itemOpt.code].longitude,
                                _this._data.countryCoordinates[itemOpt.code].latitude,
                                itemOpt.value,
                            ],
                            itemStyle: {
                                normal: {
                                    color: _this.getCountryColor(itemOpt.name),
                                },
                            },
                        };
                    })),
                },
            ],
        };
    };
    /**
     * @private
     * @param {?} countryName
     * @return {?}
     */
    BkBubbleMapComponent.prototype.getCountryColor = /**
     * @private
     * @param {?} countryName
     * @return {?}
     */
    function (countryName) {
        /** @type {?} */
        var color = this.countryColorMap[countryName];
        if (color) {
            return color;
        }
        /** @type {?} */
        var generatedColor = this.getRandomGeoColor();
        this.countryColorMap[countryName] = generatedColor;
        return generatedColor;
    };
    /**
     * @private
     * @return {?}
     */
    BkBubbleMapComponent.prototype.getRandomGeoColor = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var index = Math.round(Math.random() * this.geoColors.length);
        return this.geoColors[index];
    };
    BkBubbleMapComponent.decorators = [
        { type: Component, args: [{
                    selector: 'bk-bubble-map',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    template: "\n    <div echarts [options]=\"options\" [autoResize]=\"true\" [style.height.%]=\"100\"></div>\n  ",
                    styles: [':host { display: block }']
                }] }
    ];
    /** @nocollapse */
    BkBubbleMapComponent.ctorParameters = function () { return [
        { type: NbThemeService },
        { type: HttpClient },
        { type: ChangeDetectorRef }
    ]; };
    BkBubbleMapComponent.propDecorators = {
        data: [{ type: Input }]
    };
    return BkBubbleMapComponent;
}());
export { BkBubbleMapComponent };
if (false) {
    /** @type {?} */
    BkBubbleMapComponent.prototype.options;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype._data;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.colorConfig;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.geoColors;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.countryColorMap;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.max;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.destroyed$;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.theme;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    BkBubbleMapComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnViYmxlLW1hcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdWliYWtlcnkva2l0LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYnViYmxlLW1hcC9idWJibGUtbWFwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDaEgsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDdEMsT0FBTyxFQUFFLGFBQWEsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDO0lBbUNFLDhCQUFvQixLQUFxQixFQUFVLElBQWdCLEVBQVUsRUFBcUI7UUFBOUUsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVUsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFkbEcsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQUVWLFVBQUssR0FBK0MsRUFBRSxrQkFBa0IsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBRTVGLGdCQUFXLEdBQVEsRUFBRSxDQUFDO1FBQ3RCLGNBQVMsR0FBVSxFQUFFLENBQUM7UUFDdEIsb0JBQWUsR0FBUSxFQUFFLENBQUM7UUFFMUIsUUFBRyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBSWhCLGVBQVUsR0FBa0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUdsRCxDQUFDO0lBeEJELHNCQUFhLHNDQUFJOzs7OztRQUFqQixVQUFrQixJQUFnRDtZQUNoRSxJQUFJLENB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IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5iVGhlbWVTZXJ2aWNlIH0gZnJvbSAnQG5lYnVsYXIvdGhlbWUnO1xuaW1wb3J0IHsgTmJKU1RoZW1lT3B0aW9ucyB9IGZyb20gJ0BuZWJ1bGFyL3RoZW1lL3NlcnZpY2VzL2pzLXRoZW1lcy90aGVtZS5vcHRpb25zJztcbmltcG9ydCB7IHJlZ2lzdGVyTWFwIH0gZnJvbSAnZWNoYXJ0cyc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2JrLWJ1YmJsZS1tYXAnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgc3R5bGVzOiBbXG4gICAgJzpob3N0IHsgZGlzcGxheTogYmxvY2sgfScsXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBlY2hhcnRzIFtvcHRpb25zXT1cIm9wdGlvbnNcIiBbYXV0b1Jlc2l6ZV09XCJ0cnVlXCIgW3N0eWxlLmhlaWdodC4lXT1cIjEwMFwiPjwvZGl2PlxuICBgLFxufSlcbmV4cG9ydCBjbGFzcyBCa0J1YmJsZU1hcENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICBASW5wdXQoKSBzZXQgZGF0YShkYXRhOiB7IGNvdW50cnlDb29yZGluYXRlczoge30sIG1hcERhdGE6IGFueVtdIH0pIHtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcblxuICAgIC8vIGF2b2lkIHNob3dpbmcgbWFwIHdpdGhvdXQgY29sb3JzXG4gICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIG9wdGlvbnM6IGFueSA9IHt9O1xuXG4gIHByaXZhdGUgX2RhdGE6IHsgY291bnRyeUNvb3JkaW5hdGVzOiB7fSwgbWFwRGF0YTogYW55W10gfSA9IHsgY291bnRyeUNvb3JkaW5hdGVzOiBbXSwgbWFwRGF0YTogW10gfTtcblxuICBwcml2YXRlIGNvbG9yQ29uZmlnOiBhbnkgPSB7fTtcbiAgcHJpdmF0ZSBnZW9Db2xvcnM6IGFueVtdID0gW107XG4gIHByaXZhdGUgY291bnRyeUNvbG9yTWFwOiBhbnkgPSB7fTtcblxuICBwcml2YXRlIG1heCA9IC1JbmZpbml0eTtcblxuICBwcml2YXRlIGluaXRpYWxpemVkOiBib29sZWFuO1xuXG4gIHByaXZhdGUgZGVzdHJveWVkJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0aGVtZTogTmJUaGVtZVNlcnZpY2UsIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCwgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy5odHRwLmdldCgnYXNzZXRzL21hcC93b3JsZC5qc29uJyksXG4gICAgICB0aGlzLnRoZW1lLmdldEpzVGhlbWUoKSxcbiAgICBdKVxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpXG4gICAgICAuc3Vic2NyaWJlKChbbWFwLCBjb25maWddOiBbYW55LCBOYkpTVGhlbWVPcHRpb25zXSkgPT4ge1xuICAgICAgICByZWdpc3Rlck1hcCgnd29ybGQnLCBtYXApO1xuICAgICAgICB0aGlzLmluaXRDb2xvcnMoY29uZmlnKTtcbiAgICAgICAgdGhpcy51cGRhdGVPcHRpb25zKCk7XG5cbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0Q29sb3JzKGNvbmZpZzogTmJKU1RoZW1lT3B0aW9ucykge1xuICAgIHRoaXMuY29sb3JDb25maWcgPSBjb25maWcudmFyaWFibGVzLmJ1YmJsZU1hcDtcblxuICAgIHRoaXMuZ2VvQ29sb3JzID0gW1xuICAgICAgdGhpcy5jb2xvckNvbmZpZy5wcmltYXJ5LFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy5pbmZvLFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy5zdWNjZXNzLFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy53YXJuaW5nLFxuICAgICAgdGhpcy5jb2xvckNvbmZpZy5kYW5nZXIsXG4gICAgXTtcblxuICAgIHRoaXMuX2RhdGEubWFwRGF0YS5mb3JFYWNoKGl0ZW1PcHQgPT4ge1xuICAgICAgdGhpcy5jb3VudHJ5Q29sb3JNYXBbaXRlbU9wdC5uYW1lXSA9IHRoaXMuZ2V0UmFuZG9tR2VvQ29sb3IoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlT3B0aW9ucygpIHtcbiAgICB0aGlzLl9kYXRhLm1hcERhdGEuZm9yRWFjaCgoaXRlbU9wdCkgPT4ge1xuICAgICAgaWYgKGl0ZW1PcHQudmFsdWUgPiB0aGlzLm1heCkge1xuICAgICAgICB0aGlzLm1heCA9IGl0ZW1PcHQudmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICB0aXRsZToge1xuICAgICAgICB0ZXh0OiAnV29ybGQgUG9wdWxhdGlvbiAoMjAxMSknLFxuICAgICAgICBsZWZ0OiAnY2VudGVyJyxcbiAgICAgICAgdG9wOiAndG9wJyxcbiAgICAgICAgdGV4dFN0eWxlOiB7XG4gICAgICAgICAgY29sb3I6IHRoaXMuY29sb3JDb25maWcudGl0bGVDb2xvcixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB0b29sdGlwOiB7XG4gICAgICAgIHRyaWdnZXI6ICdpdGVtJyxcbiAgICAgICAgZm9ybWF0dGVyOiBwYXJhbXMgPT4ge1xuICAgICAgICAgIHJldHVybiBwYXJhbXMubmFtZSArICc6ICcgKyBwYXJhbXMudmFsdWVbMl07XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdmlzdWFsTWFwOiB7XG4gICAgICAgIHNob3c6IGZhbHNlLFxuICAgICAgICBtaW46IDAsXG4gICAgICAgIG1heDogdGhpcy5tYXgsXG4gICAgICAgIGluUmFuZ2U6IHtcbiAgICAgICAgICBzeW1ib2xTaXplOiBbNiwgNjBdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGdlbzoge1xuICAgICAgICBuYW1lOiAnV29ybGQgUG9wdWxhdGlvbiAoMjAxMCknLFxuICAgICAgICB0eXBlOiAnbWFwJyxcbiAgICAgICAgbWFwOiAnd29ybGQnLFxuICAgICAgICByb2FtOiB0cnVlLFxuICAgICAgICBsYWJlbDoge1xuICAgICAgICAgIGVtcGhhc2lzOiB7XG4gICAgICAgICAgICBzaG93OiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBpdGVtU3R5bGU6IHtcbiAgICAgICAgICBub3JtYWw6IHtcbiAgICAgICAgICAgIGFyZWFDb2xvcjogdGhpcy5jb2xvckNvbmZpZy5hcmVhQ29sb3IsXG4gICAgICAgICAgICBib3JkZXJDb2xvcjogdGhpcy5jb2xvckNvbmZpZy5hcmVhQm9yZGVyQ29sb3IsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbXBoYXNpczoge1xuICAgICAgICAgICAgYXJlYUNvbG9yOiB0aGlzLmNvbG9yQ29uZmlnLmFyZWFIb3ZlckNvbG9yLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHpvb206IDEuMSxcbiAgICAgIH0sXG4gICAgICBzZXJpZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdzY2F0dGVyJyxcbiAgICAgICAgICBjb29yZGluYXRlU3lzdGVtOiAnZ2VvJyxcbiAgICAgICAgICBkYXRhOiB0aGlzLl9kYXRhLm1hcERhdGEubWFwKGl0ZW1PcHQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgbmFtZTogaXRlbU9wdC5uYW1lLFxuICAgICAgICAgICAgICB2YWx1ZTogW1xuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEuY291bnRyeUNvb3JkaW5hdGVzW2l0ZW1PcHQuY29kZV0ubG9uZ2l0dWRlLFxuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEuY291bnRyeUNvb3JkaW5hdGVzW2l0ZW1PcHQuY29kZV0ubGF0aXR1ZGUsXG4gICAgICAgICAgICAgICAgaXRlbU9wdC52YWx1ZSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgaXRlbVN0eWxlOiB7XG4gICAgICAgICAgICAgICAgbm9ybWFsOiB7XG4gICAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5nZXRDb3VudHJ5Q29sb3IoaXRlbU9wdC5uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q291bnRyeUNvbG9yKGNvdW50cnlOYW1lKSB7XG4gICAgY29uc3QgY29sb3IgPSB0aGlzLmNvdW50cnlDb2xvck1hcFtjb3VudHJ5TmFtZV07XG4gICAgaWYgKGNvbG9yKSB7XG4gICAgICByZXR1cm4gY29sb3I7XG4gICAgfVxuXG4gICAgY29uc3QgZ2VuZXJhdGVkQ29sb3IgPSB0aGlzLmdldFJhbmRvbUdlb0NvbG9yKCk7XG4gICAgdGhpcy5jb3VudHJ5Q29sb3JNYXBbY291bnRyeU5hbWVdID0gZ2VuZXJhdGVkQ29sb3I7XG5cbiAgICByZXR1cm4gZ2VuZXJhdGVkQ29sb3I7XG4gIH1cblxuICBwcml2YXRlIGdldFJhbmRvbUdlb0NvbG9yKCkge1xuICAgIGNvbnN0IGluZGV4ID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogdGhpcy5nZW9Db2xvcnMubGVuZ3RoKTtcbiAgICByZXR1cm4gdGhpcy5nZW9Db2xvcnNbaW5kZXhdO1xuICB9XG59XG4iXX0=